<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Оплата — Hiddify VPN</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<section class="section">
  <h2>Оплата подписки Hiddify VPN</h2>

  <div class="pay-box">
    <h3>Наведите камерой на QR-код</h3>

    <!-- QR -->
    <img id="bank-qr" class="pay-qr" src="" alt="QR для оплаты">

    <!-- Link -->
    <a id="bank-link" class="btn-main" href="#" target="_blank">
      Перейти в Сбербанк для перевода
    </a>

    <!-- FORM -->
    <form id="contact-form" class="contact-box">
      <h4>
        После оплаты оставьте ваши контактные данные,
        чтобы мы отправили вам ключ доступа.
      </h4>

      <input name="firstname" placeholder="Имя *" required>
      <input name="lastname" placeholder="Фамилия *" required>

      <input name="sender_phone"
        placeholder="Номер телефона, с которого оплатили *"
        required>

      <input name="contact_phone"
        placeholder="Ваш номер для связи *"
        required>

      <input name="email"
        type="email"
        placeholder="Email (необязательно)">

      <input name="messenger"
        placeholder="WhatsApp / Telegram / MAX (необязательно)">

      <button type="submit" class="btn-main">
        Отправить данные
      </button>

      <p class="contact-note">
        Мы вышлем ключ после подтверждения оплаты.
      </p>
    </form>

  </div>
</section>

<script>
/* ===== QR ПО ОЧЕРЕДИ ===== */

const banks = [
  {
    qr: "img/pay1.png",
    link: "https://www.sberbank.com/sms/pbpn?requisiteNumber=79203794100"
  },
  {
    qr: "img/pay3.png",
    link: "https://www.sberbank.com/sms/pbpn?requisiteNumber=79298791010"
  }
];

let index = sessionStorage.getItem("payBankIndex");
index = index ? parseInt(index) : 0;

const bank = banks[index];

document.getElementById("bank-qr").src = bank.qr;
document.getElementById("bank-link").href = bank.link;

index = (index + 1) % banks.length;
sessionStorage.setItem("payBankIndex", index);


/* ===== TELEGRAM ОТПРАВКА ===== */

const TOKEN = "8423320027:AAHyfWUUeG4XOvb-dJOErknUF3AKt__Wheo";
const CHAT_ID = "708010287";

document.getElementById("contact-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);

  const text =
    "Новая заявка оплаты Hiddify VPN:\n\n" +
    "Имя: " + formData.get("firstname") + "\n" +
    "Фамилия: " + formData.get("lastname") + "\n" +
    "Телефон отправителя: " + formData.get("sender_phone") + "\n" +
    "Телефон для связи: " + formData.get("contact_phone") + "\n" +
    "Email: " + formData.get("email") + "\n" +
    "Мессенджер: " + formData.get("messenger");

  await fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: text
    })
  });

  alert("Данные отправлены. Мы скоро вышлем ключ.");
  e.target.reset();
});
</script>

</body>
</html>
